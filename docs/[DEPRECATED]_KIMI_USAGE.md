# [DEPRECATED] Kimi 文本润色功能使用说明

> ⚠️ **注意**: 此功能已废弃，不再维护。现在使用 OpenAI GPT-4o transcribe 自带标点符号，无需额外润色。

## 废弃说明

- **当前推荐方案**: 使用 `Ctrl+F` 调用 OpenAI GPT-4o transcribe，自带高质量标点符号
- **省钱方案**: 使用 `Ctrl+I` 调用本地 whisper.cpp，速度快但无标点符号
- **Kimi功能状态**: 代码保留但不推荐使用

---

# Kimi 文本润色功能使用说明 (已废弃)

## 功能介绍

Kimi文本润色功能已集成到Whisper-Input项目中，可以对语音识别的结果进行智能润色，主要功能包括：

1. **添加标点符号**：为识别出的文本添加逗号、句号、问号等标点符号
2. **修正识别错误**：修正明显的语音识别错误
3. **提升可读性**：让文本更加流畅和易读
4. **保持原意**：不改变原文的语言和意思

## 配置信息

- **API提供商**：Moonshot AI (Kimi)
- **模型**：kimi-k2-0711-preview
- **API基地址**：https://api.moonshot.cn/v1
- **API密钥**：需要自行配置环境变量 `KIMI_API_KEY`

## 使用方法

### 配置API密钥

首先需要配置Kimi API密钥：

```bash
export KIMI_API_KEY="your_kimi_api_key_here"
```

### 双快捷键模式

现在支持两种不同的录音模式：

#### 普通转录模式（Ctrl + F）
- 快捷键：`Ctrl + F`
- 功能：直接进行语音转录，不使用 Kimi 润色
- 适用场景：快速录入，保持原始转录结果

#### Kimi 润色模式（Ctrl + I）
- 快捷键：`Ctrl + I`
- 功能：语音转录 + Kimi AI 润色优化
- 适用场景：需要高质量文本输出，自动添加标点符号和修正错误

两种模式都是 Toggle 操作：按一下开始录音，再按一下停止录音。

### 测试API功能

运行测试脚本验证API是否正常工作：

```bash
python test_kimi_api.py
```

## 效果示例

### 双模式对比

| 原始语音 | 普通模式 (Ctrl+F) | Kimi润色模式 (Ctrl+Y) |
|---|---|---|
| "你好这是一个测试文本没有标点符号需要润色一下" | 你好这是一个测试文本没有标点符号需要润色一下 | 你好，这是一个测试文本，没有标点符号，需要润色一下。 |
| "今天天气很好我想出去走走不知道去哪里比较好" | 今天天气很好我想出去走走不知道去哪里比较好 | 今天天气很好，我想出去走走，不知道去哪里比较好。 |
| "我正在测试这个语音输入软件看看效果怎么样" | 我正在测试这个语音输入软件看看效果怎么样 | 我正在测试这个语音输入软件，看看效果怎么样。 |

### 使用建议

- **快速记录**：使用 `Ctrl + F` 普通模式，保持转录速度
- **正式文档**：使用 `Ctrl + I` 润色模式，获得高质量文本
- **即时选择**：根据当前需求灵活切换两种模式

## 集成说明

Kimi润色功能已集成到所有三个语音处理器中：

1. **WhisperProcessor** (GROQ平台)
2. **SenseVoiceSmallProcessor** (SiliconFlow平台)  
3. **LocalWhisperProcessor** (本地whisper.cpp)

### 处理流程

1. 语音录制完成
2. 调用语音识别API/本地whisper.cpp
3. **如果启用Kimi润色**：调用Kimi API进行文本润色
4. 输出最终结果到光标位置

## 注意事项

1. **网络要求**：需要稳定的网络连接访问Moonshot API
2. **响应时间**：Kimi API处理通常需要2-3秒
3. **容错机制**：如果API调用失败，会自动返回原始识别文本
4. **语言支持**：主要针对中文优化，同时支持英文

## 故障排除

### API调用失败
- 检查网络连接
- 确认API密钥有效
- 查看日志中的详细错误信息

### 润色效果不理想
- 可以通过修改 `src/llm/kimi.py` 中的系统提示词来调整润色风格
- 或者设置 `ENABLE_KIMI_POLISH=false` 禁用此功能

## 版本更新

- **2024-07-18**：首次集成Kimi润色功能
- 替代了原有的GROQ标点符号处理
- 支持所有三个语音处理平台 